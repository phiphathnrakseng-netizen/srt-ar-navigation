<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <title>ระบบนำทาง AR | วิทยาลัยเทคนิคสุราษฎร์ธานี</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* STC Official Colors */
            --stc-navy: #002D62;      /* น้ำเงินหลัก */
            --stc-maroon: #800000;    /* แดงเลือดหมู */
            --stc-gold: #B8860B;      /* ทอง */
            --stc-beige-bg: #FAF9F6;  /* เบจมินิมอล */
            --stc-white: #FFFFFF;
        }

        body { 
            font-family: 'Noto Sans Thai', sans-serif; 
            background-color: var(--stc-beige-bg); 
            color: #2D3436;
            margin: 0;
            -webkit-font-smoothing: antialiased;
        }

        /* --- Loading Screen (Formal Style) --- */
        #loading-screen {
            position: fixed; inset: 0;
            background: var(--stc-white);
            z-index: 9999;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }

        .logo-frame {
            width: 150px; height: 150px;
            border: 2px solid var(--stc-maroon);
            padding: 10px;
            margin-bottom: 2rem;
            animation: fadeIn 1.2s ease-in-out;
        }

        /* --- Header & Navigation --- */
        .top-nav {
            background: var(--stc-white);
            border-bottom: 3px solid var(--stc-maroon);
            height: 80px;
        }

        .official-header {
            background: var(--stc-navy);
            color: white;
            padding: 4rem 2rem;
            border-bottom: 8px solid var(--stc-maroon);
            position: relative;
        }

        .official-header::after {
            content: "";
            position: absolute; bottom: 0; right: 0;
            width: 30%; height: 100%;
            background: linear-gradient(to left, rgba(128,0,0,0.2), transparent);
        }

        /* --- Components (Minimal Rounding) --- */
        .btn-stc {
            background: var(--stc-maroon);
            color: white;
            border-radius: 4px !important; /* เหลี่ยมมินิมอล */
            font-weight: 600;
            transition: all 0.3s;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }

        .btn-stc:hover { background: #600000; transform: translateY(-2px); }

        .room-card {
            background: white;
            border: 1px solid #E2E8F0;
            border-top: 4px solid var(--stc-maroon);
            border-radius: 2px !important;
            transition: all 0.3s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .room-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-top-color: var(--stc-navy);
        }

        .nav-link {
            font-weight: 700; color: var(--stc-navy);
            border-bottom: 3px solid transparent;
            transition: 0.2s;
        }

        .nav-link-active { border-bottom-color: var(--stc-maroon); color: var(--stc-maroon); }

        /* Helpers */
        .text-maroon { color: var(--stc-maroon); }
        .bg-beige { background-color: var(--stc-beige-bg); }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="logo-frame flex items-center justify-center">
            <img src="https://upload.wikimedia.org/wikipedia/th/a/a2/Surat_Thani_Technical_College_Logo.png" alt="STC Logo" class="w-full h-full object-contain">
        </div>
        <h2 class="text-stc-navy font-bold text-xl tracking-wide">วิทยาลัยเทคนิคสุราษฎร์ธานี</h2>
        <div class="w-48 h-1 bg-gray-100 mt-6 relative overflow-hidden">
            <div id="progress-fill" class="absolute inset-y-0 left-0 bg-maroon-700 w-0 transition-all duration-300" style="background: var(--stc-maroon);"></div>
        </div>
        <p id="speed-text" class="text-xs mt-3 text-gray-400 font-medium uppercase tracking-widest">System Initializing...</p>
    </div>

    <nav class="top-nav sticky top-0 z-50 flex justify-between items-center px-6 shadow-sm">
        <div class="flex items-center gap-3">
            <img src="https://upload.wikimedia.org/wikipedia/th/a/a2/Surat_Thani_Technical_College_Logo.png" class="h-12 w-12 object-contain" alt="STC">
            <div class="hidden md:block">
                <div class="font-bold text-sm text-[#002D62] leading-none uppercase">Surat Thani Technical College</div>
                <div class="text-[10px] font-bold text-red-800 tracking-widest">IT DEPARTMENT AR-NAV</div>
            </div>
        </div>
        <div class="flex h-full items-center gap-6">
            <a href="index.html" class="nav-link px-2 h-full flex items-center text-sm" id="nav-home">หน้าแรก</a>
            <a href="?floor=3" class="nav-link px-2 h-full flex items-center text-sm" id="nav-f3">ชั้น 3</a>
            <a href="?floor=4" class="nav-link px-2 h-full flex items-center text-sm" id="nav-f4">ชั้น 4</a>
            <button onclick="openDeptModal()" class="btn-stc px-4 py-2 text-xs uppercase">เส้นทางหลัก</button>
        </div>
    </nav>

    <header class="official-header">
        <div class="max-w-6xl mx-auto">
            <span class="inline-block bg-white/10 px-3 py-1 text-[10px] font-bold tracking-[0.2em] mb-4 border-l-4 border-white">OFFICIAL AR SYSTEM</span>
            <h1 class="text-3xl md:text-5xl font-black mb-4">
                ระบบนำทางอาคารอัจฉริยะ<br>
                <span class="text-white/70 font-light">แผนกวิชาเทคโนโลยีสารสนเทศ</span>
            </h1>
            <p id="header-desc" class="text-gray-300 max-w-xl text-sm leading-relaxed border-t border-white/20 pt-4">
                จุดเริ่มต้น: ประตูทางเข้าวิทยาลัย (ประตู 1) มุ่งหน้าสู่อาคารแผนกเทคโนโลยีสารสนเทศ
            </p>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-6 py-12">
        <div id="search-container" class="mb-10 hidden">
            <div class="bg-white p-2 border border-gray-200 shadow-sm flex items-center">
                <div class="px-4 text-maroon"><i class="fa-solid fa-search"></i></div>
                <input type="text" id="searchInput" onkeyup="searchRoom()" placeholder="ค้นหาห้องเรียนหรือห้องปฏิบัติการ..." class="w-full py-3 outline-none font-medium text-lg bg-transparent">
                <div class="px-4 text-xs font-bold text-gray-400 border-l">FLOOR <span id="floor-title">--</span></div>
            </div>
        </div>

        <div id="start-phase" class="hidden">
            <h3 class="text-maroon font-bold text-lg mb-6 flex items-center gap-2">
                <div class="w-8 h-1 bg-maroon-700"></div> เลือกจุดเริ่มต้นการนำทาง
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <button onclick="directNavigate('TO_IT_BUILDING')" class="room-card p-8 text-left group">
                    <i class="fa-solid fa-school text-3xl mb-4 text-[#002D62]"></i>
                    <h4 class="text-xl font-bold mb-2">ป้อมยาม <i class="fa-solid fa-arrow-right-long text-maroon mx-2"></i> แผนกไอที</h4>
                    <p class="text-gray-400 text-xs">สำหรับผู้ที่เพิ่งเดินทางมาถึงวิทยาลัย</p>
                </button>
                <button onclick="directNavigate('FROM_IT_TO_GATE')" class="room-card p-8 text-left group">
                    <i class="fa-solid fa-door-open text-3xl mb-4 text-[#002D62]"></i>
                    <h4 class="text-xl font-bold mb-2">แผนกไอที <i class="fa-solid fa-arrow-right-long text-maroon mx-2"></i> ป้อมยาม</h4>
                    <p class="text-gray-400 text-xs">สำหรับนำทางออกจากอาคารไปประตูทางเข้า</p>
                </button>
            </div>
        </div>

        <div id="floor-3" class="hidden">
            <h3 class="text-maroon font-bold text-lg mb-6 uppercase tracking-widest">Classrooms & Resources (Floor 3)</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="rooms-3"></div>
        </div>

        <div id="floor-4" class="hidden">
            <h3 class="text-maroon font-bold text-lg mb-6 uppercase tracking-widest">Laboratories & Staff (Floor 4)</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="rooms-4"></div>
        </div>
    </main>

    <div id="room-detail-modal" class="fixed inset-0 z-[150] flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-[#001A35]/80 backdrop-blur-sm" onclick="closeRoomDetail()"></div>
        <div class="relative bg-white w-full max-w-md shadow-2xl overflow-hidden border-t-8 border-maroon-800" style="border-top-color: var(--stc-maroon);">
            <div class="p-6">
                <div class="flex justify-between items-start mb-4">
                    <div class="bg-beige px-3 py-1 text-[10px] font-bold text-maroon border border-maroon-100 uppercase" id="modal-room-id">ROOM ID</div>
                    <button onclick="closeRoomDetail()" class="text-gray-400 hover:text-red-600"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>
                <img id="modal-room-image" src="" class="w-full h-48 object-cover mb-6 border border-gray-100" onerror="this.src='https://placehold.co/600x400/002D62/FFF?text=IT+STC'">
                <h3 id="modal-room-name" class="text-2xl font-black text-[#002D62] mb-2">ชื่อห้องเรียน</h3>
                <p id="modal-room-guide" class="text-gray-500 text-sm leading-relaxed mb-8">คำแนะนำการเดิน...</p>
                <button id="btn-start-nav" class="w-full btn-stc py-4 text-sm uppercase tracking-widest">
                    <i class="fa-solid fa-location-arrow"></i> เริ่มการนำทาง AR
                </button>
            </div>
        </div>
    </div>

    <script>
        // Data Structure (ห้ามหาย)
        const navigationData = {
            "TO_IT_BUILDING": { angle: 0, dist: 195, guide: "จากป้อมยามเดินตรงเข้ามาชั้นล่างตึกไอที (ตึกม่วง)" },
            "FROM_IT_TO_GATE": { angle: 180, dist: 195, guide: "จากหน้าตึกไอทีเดินย้อนกลับไปที่ป้อมยามหน้าประตู 1" },
            "DEPT_LABEL_3": { angle: 0, dist: 2, guide: "คุณอยู่บริเวณโถงหน้าป้ายแผนกชั้น 3" },
            "631": { angle: 90, dist: 15, guide: "จากโถงชั้น 3 เดินไปทางขวาสุด" },
            "632": { angle: 90, dist: 10, guide: "จากโถงชั้น 3 เดินไปทางขวา" },
            "633": { angle: 270, dist: 12, guide: "จากโถงชั้น 3 เดินไปทางซ้าย" },
            "634": { angle: 90, dist: 22, guide: "จากโถงชั้น 3 เดินไปทางขวาสุด (โซนศูนย์บ่มเพาะ)" },
            "635": { angle: 270, dist: 5, guide: "จากโถงชั้น 3 เลี้ยวซ้ายทันที (ติดบันได)" },
            "DEPT_LABEL_4": { angle: 0, dist: 2, guide: "คุณอยู่บริเวณหน้าโถงทางเข้าชั้น 4" },
            "TEACHER_ROOM": { angle: 90, dist: 5, guide: "จากโถงบันไดชั้น 4 เลี้ยวขวาเข้าห้องพักครู" },
            "LECTURE": { angle: 270, dist: 8, guide: "จากโถงบันไดชั้น 4 เลี้ยวซ้ายไปห้องบรรยาย" },
            "LAB1": { angle: 0, dist: 15, guide: "จากโถงชั้น 4 เดินตรงไปห้องแล็บ 1" },
            "LAB2": { angle: 0, dist: 18, guide: "จากโถงชั้น 4 เดินตรงไปห้องแล็บ 2" },
            "LAB3": { angle: 0, dist: 20, guide: "จากโถงชั้น 4 เดินตรงไปห้องแล็บ 3" }
        };

        const roomNames = {
            "TEACHER_ROOM": "ห้องพักครู", "LECTURE": "ห้อง Lecture", "LAB1": "ห้อง Lab 1", "LAB2": "ห้อง Lab 2", "LAB3": "ห้อง Lab 3",
            "631": "ห้อง 631", "632": "ห้อง 632", "633": "ห้อง 633", "634": "ห้อง 634", "635": "ห้อง 635"
        };

        const roomImages = {
            'TEACHER_ROOM': 'breakteacher.jpeg', 'LECTURE': 'lecture.jpeg', 'LAB1': 'lab 1.jpeg',
            'LAB2': 'lab 2.jpeg', 'LAB3': 'lab 3.jpeg', '631': '631.jpeg', '632': '632.jpeg',
            '633': '633.jpeg', '634': '634.jpeg', '635': '635.jpeg'
        };

        function runLoading() {
            const loadingScreen = document.getElementById('loading-screen');
            const progressFill = document.getElementById('progress-fill');
            const isFirstVisit = !sessionStorage.getItem('stc_init');
            if (!isFirstVisit) { loadingScreen.style.display = 'none'; return; }
            
            let progress = 0;
            const timer = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100; clearInterval(timer);
                    setTimeout(() => {
                        loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                            sessionStorage.setItem('stc_init', 'true');
                        }, 500);
                    }, 500);
                }
                progressFill.style.width = progress + '%';
            }, 100);
        }

        function renderRooms(floor) {
            const container = document.getElementById(`rooms-${floor}`);
            if (!container) return;
            container.innerHTML = '';
            
            Object.keys(navigationData).forEach(key => {
                if (key.includes("TO_") || key.includes("FROM_") || key.startsWith("DEPT_")) return;
                const isFloor3 = ['631','632','633','634','635'].includes(key);
                if ((floor === 3 && isFloor3) || (floor === 4 && !isFloor3)) {
                    container.innerHTML += `
                        <button onclick="openRoomDetail('${key}')" class="room-card p-6 text-left group">
                            <div class="text-[10px] font-bold text-gray-400 mb-2 uppercase tracking-tighter">Room ID: ${key}</div>
                            <h4 class="text-lg font-bold text-[#002D62] mb-4">${roomNames[key] || key}</h4>
                            <div class="text-maroon font-bold text-xs flex items-center gap-2 italic">
                                VIEW DETAIL <i class="fa-solid fa-arrow-right text-[10px]"></i>
                            </div>
                        </button>`;
                }
            });
        }

        function openRoomDetail(roomId) {
            const data = navigationData[roomId];
            document.getElementById('modal-room-id').innerText = roomId;
            document.getElementById('modal-room-name').innerText = roomNames[roomId] || roomId;
            document.getElementById('modal-room-guide').innerText = data.guide + ` (ระยะทางประมาณ ${data.dist} เมตร)`;
            document.getElementById('modal-room-image').src = roomImages[roomId] || '';
            document.getElementById('btn-start-nav').onclick = () => directNavigate(roomId);
            document.getElementById('room-detail-modal').classList.remove('hidden');
        }

        function closeRoomDetail() { document.getElementById('room-detail-modal').classList.add('hidden'); }

        function initApp() {
            const params = new URLSearchParams(window.location.search);
            const floor = params.get('floor');
            
            if (floor === '3' || floor === '4') {
                document.getElementById(`floor-${floor}`).classList.remove('hidden');
                document.getElementById('search-container').classList.remove('hidden');
                document.getElementById(`nav-f${floor}`).classList.add('nav-link-active');
                document.getElementById('floor-title').innerText = floor;
                renderRooms(parseInt(floor));
            } else {
                document.getElementById('start-phase').classList.remove('hidden');
                document.getElementById('nav-home').classList.add('nav-link-active');
            }
        }

        function directNavigate(roomId) {
            const data = navigationData[roomId];
            window.location.href = `ar-view.html?target=${roomId}&angle=${data.angle}&dist=${data.dist}&guide=${encodeURIComponent(data.guide)}`;
        }

        function searchRoom() {
            const input = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.room-card').forEach(card => {
                card.style.display = card.textContent.toLowerCase().includes(input) ? 'block' : 'none';
            });
        }

        window.onload = () => { runLoading(); initApp(); };
    </script>
</body>
</html>
