<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <title>ระบบนำทาง AR | วิทยาลัยเทคนิคสุราษฎร์ธานี</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --stc-navy: #002D62;      /* น้ำเงินหลัก */
            --stc-maroon: #800000;    /* แดงเลือดหมู */
            --stc-gold: #B8860B;      /* ทอง */
            --stc-beige-bg: #FAF9F6;  /* เบจมินิมอล */
            --stc-white: #FFFFFF;
        }

        body { 
            font-family: 'Noto Sans Thai', sans-serif; 
            background-color: var(--stc-beige-bg); 
            color: #2D3436;
            margin: 0;
            -webkit-font-smoothing: antialiased;
        }

        /* --- Loading Screen --- */
        #loading-screen {
            position: fixed; inset: 0;
            background: var(--stc-white);
            z-index: 9999;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }

        .logo-frame {
            width: 160px; height: 160px;
            padding: 10px;
            margin-bottom: 1.5rem;
            animation: pulseCustom 2s infinite ease-in-out;
        }

        @keyframes pulseCustom {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* --- UI Components --- */
        .top-nav {
            background: var(--stc-white);
            border-bottom: 3px solid var(--stc-maroon);
            height: 70px;
        }

        .official-header {
            background: linear-gradient(135deg, var(--stc-navy) 0%, #001a35 100%);
            color: white;
            padding: 3.5rem 2rem;
            border-bottom: 6px solid var(--stc-maroon);
            position: relative;
            overflow: hidden;
        }

        .btn-stc {
            background: var(--stc-maroon);
            color: white;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }

        .btn-stc:hover { background: #600000; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(128,0,0,0.2); }

        .room-card {
            background: white;
            border: 1px solid #E2E8F0;
            border-top: 4px solid var(--stc-maroon);
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .room-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.1);
            border-top-color: var(--stc-navy);
        }

        .nav-link {
            font-weight: 600; color: var(--stc-navy);
            position: relative;
            transition: 0.3s;
        }

        .nav-link-active { color: var(--stc-maroon); }
        .nav-link-active::after {
            content: ""; position: absolute; bottom: -10px; left: 0; width: 100%; height: 3px; background: var(--stc-maroon);
        }

        .stc-logo-img {
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="logo-frame">
            <img src="https://scontent.furt2-1.fna.fbcdn.net/v/t39.30808-6/223303958_665537047696775_5725965526684764441_n.jpg?_nc_cat=108&ccb=1-7&_nc_sid=a5f93a&_nc_eui2=AeHYdDp67RfF6Yo008Da8znibSDAaVG9sWptIMBpUb2xaskuSs8Dg-GqxsRQzyU0pPy_Mf3g1YP_1vszniK1R7r4&_nc_ohc=iLPCoGJ_o9MQ7kNvwHGpOes&_nc_oc=Admc76_VFpmfz4NLFaNjJqUwuNqOFeHLFGbaDxOaPCDS26LE8Iplmx8f5_Ma6B3ikqc&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&_nc_gid=FC6zBJ6W_D2X94i0VBQJwg&oh=00_AfsonydYo7dgiP0FZA4xHtgd_gWZS0fY2QnA_BiHk665SQ&oe=69926B7A" 
                 alt="STC Logo" class="w-full h-full object-contain stc-logo-img">
        </div>
        <h2 class="text-[#002D62] font-bold text-xl tracking-wide">วิทยาลัยเทคนิคสุราษฎร์ธานี</h2>
        <div class="w-48 h-1.5 bg-gray-100 mt-6 rounded-full overflow-hidden">
            <div id="progress-fill" class="h-full bg-maroon-700 w-0 transition-all duration-300" style="background: var(--stc-maroon);"></div>
        </div>
        <p id="speed-text" class="text-[10px] mt-4 text-gray-400 font-bold uppercase tracking-[0.2em]">System Initializing</p>
    </div>

    <nav class="top-nav sticky top-0 z-50 flex justify-between items-center px-6 shadow-md">
        <div class="flex items-center gap-3">
            <img src="https://scontent.furt2-1.fna.fbcdn.net/v/t39.30808-6/223303958_665537047696775_5725965526684764441_n.jpg?_nc_cat=108&ccb=1-7&_nc_sid=a5f93a&_nc_eui2=AeHYdDp67RfF6Yo008Da8znibSDAaVG9sWptIMBpUb2xaskuSs8Dg-GqxsRQzyU0pPy_Mf3g1YP_1vszniK1R7r4&_nc_ohc=iLPCoGJ_o9MQ7kNvwHGpOes&_nc_oc=Admc76_VFpmfz4NLFaNjJqUwuNqOFeHLFGbaDxOaPCDS26LE8Iplmx8f5_Ma6B3ikqc&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&_nc_gid=FC6zBJ6W_D2X94i0VBQJwg&oh=00_AfsonydYo7dgiP0FZA4xHtgd_gWZS0fY2QnA_BiHk665SQ&oe=69926B7A" 
                 class="h-12 w-12 object-contain" alt="STC">
            <div class="hidden sm:block">
                <div class="font-bold text-xs text-[#002D62] leading-tight">วิทยาลัยเทคนิคสุราษฎร์ธานี</div>
                <div class="text-[9px] font-bold text-red-800 tracking-wider">IT DEPARTMENT AR-NAV</div>
            </div>
        </div>
        <div class="flex h-full items-center gap-5">
            <a href="index.html" class="nav-link text-sm" id="nav-home">หน้าแรก</a>
            <a href="?floor=3" class="nav-link text-sm" id="nav-f3">ชั้น 3</a>
            <a href="?floor=4" class="nav-link text-sm" id="nav-f4">ชั้น 4</a>
        </div>
    </nav>

    <header class="official-header">
        <div class="max-w-6xl mx-auto relative z-10">
            <span class="inline-block bg-white/10 backdrop-blur-md px-3 py-1 text-[10px] font-bold tracking-[0.2em] mb-4 border-l-4 border-white">SMART CAMPUS NAVIGATION</span>
            <h1 class="text-3xl md:text-5xl font-black mb-4 leading-tight">
                ระบบนำทางอัจฉริยะ AR<br>
                <span class="text-white/60 font-light">แผนกวิชาเทคโนโลยีสารสนเทศ</span>
            </h1>
            <p id="header-desc" class="text-gray-300 max-w-xl text-sm leading-relaxed border-t border-white/20 pt-4">
                ยินดีต้อนรับเข้าสู่ระบบนำทางเสมือนจริง โปรดเลือกจุดหมายปลายทางที่ต้องการ
            </p>
        </div>
        <div class="absolute -right-20 -top-20 w-80 h-80 bg-maroon-900/20 rounded-full blur-3xl"></div>
    </header>

    <main class="max-w-6xl mx-auto px-6 py-10">
        <div id="search-container" class="mb-10 hidden">
            <div class="bg-white p-1 rounded-lg border border-gray-200 shadow-sm flex items-center">
                <div class="px-5 text-maroon"><i class="fa-solid fa-magnifying-glass"></i></div>
                <input type="text" id="searchInput" onkeyup="searchRoom()" placeholder="ค้นหาห้องเรียน..." class="w-full py-4 outline-none font-medium text-gray-700 bg-transparent">
                <div class="px-5 py-2 text-[10px] font-black text-white bg-navy-900 rounded-md bg-[#002D62] mr-1">FLOOR <span id="floor-title">--</span></div>
            </div>
        </div>

        <div id="start-phase" class="hidden">
            <div class="flex items-center gap-3 mb-8">
                <div class="w-2 h-8 bg-maroon-800"></div>
                <h3 class="text-xl font-bold text-[#002D62]">เส้นทางภายนอกอาคาร</h3>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <button onclick="directNavigate('TO_IT_BUILDING')" class="room-card p-8 text-left group bg-white">
                    <div class="w-14 h-14 bg-blue-50 rounded-xl flex items-center justify-center mb-6 group-hover:bg-blue-600 transition-colors">
                        <i class="fa-solid fa-map-location-dot text-2xl text-[#002D62] group-hover:text-white"></i>
                    </div>
                    <h4 class="text-xl font-bold mb-2">ประตู 1 <i class="fa-solid fa-arrow-right-long text-maroon mx-2"></i> แผนกไอที</h4>
                    <p class="text-gray-400 text-xs">สำหรับนำทางจากหน้าวิทยาลัยเข้าสู่ตัวอาคารแผนก</p>
                </button>
                <button onclick="directNavigate('FROM_IT_TO_GATE')" class="room-card p-8 text-left group bg-white">
                    <div class="w-14 h-14 bg-red-50 rounded-xl flex items-center justify-center mb-6 group-hover:bg-maroon-700 transition-colors">
                        <i class="fa-solid fa-door-open text-2xl text-maroon group-hover:text-white"></i>
                    </div>
                    <h4 class="text-xl font-bold mb-2">แผนกไอที <i class="fa-solid fa-arrow-right-long text-maroon mx-2"></i> ประตู 1</h4>
                    <p class="text-gray-400 text-xs">สำหรับนำทางออกจากแผนกไปที่ประตูทางเข้าหลัก</p>
                </button>
            </div>
        </div>

        <div id="floor-3" class="hidden">
            <h3 class="text-maroon font-black text-lg mb-6 uppercase tracking-widest flex items-center gap-2">
                <i class="fa-solid fa-layer-group"></i> Classrooms (Floor 3)
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="rooms-3"></div>
        </div>

        <div id="floor-4" class="hidden">
            <h3 class="text-maroon font-black text-lg mb-6 uppercase tracking-widest flex items-center gap-2">
                <i class="fa-solid fa-flask-vial"></i> Laboratories (Floor 4)
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="rooms-4"></div>
        </div>
    </main>

    <div id="room-detail-modal" class="fixed inset-0 z-[150] flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-[#001A35]/90 backdrop-blur-md" onclick="closeRoomDetail()"></div>
        <div class="relative bg-white w-full max-w-md shadow-2xl rounded-2xl overflow-hidden animate-[fadeIn_0.3s_ease-out]">
            <div class="p-6">
                <div class="flex justify-between items-start mb-6">
                    <div class="bg-gray-100 px-3 py-1.5 rounded-md text-[10px] font-bold text-maroon uppercase tracking-wider" id="modal-room-id">ROOM ID</div>
                    <button onclick="closeRoomDetail()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors">
                        <i class="fa-solid fa-xmark text-gray-400"></i>
                    </button>
                </div>
                <div class="relative rounded-xl overflow-hidden mb-6 bg-gray-100 aspect-video border border-gray-100">
                    <img id="modal-room-image" src="" class="w-full h-full object-cover" onerror="this.src='https://placehold.co/600x400/002D62/FFF?text=IT+STC'">
                </div>
                <h3 id="modal-room-name" class="text-2xl font-black text-[#002D62] mb-3">ชื่อห้องเรียน</h3>
                <div class="flex items-start gap-3 p-4 bg-beige rounded-lg mb-8">
                    <i class="fa-solid fa-circle-info text-maroon mt-1"></i>
                    <p id="modal-room-guide" class="text-gray-600 text-sm leading-relaxed">คำแนะนำการเดินทาง...</p>
                </div>
                <button id="btn-start-nav" class="w-full btn-stc py-4 text-sm uppercase tracking-[0.2em] shadow-lg">
                    <i class="fa-solid fa-location-arrow"></i> เริ่มการนำทาง AR
                </button>
            </div>
        </div>
    </div>

    <script>
        // โครงสร้างข้อมูลเดิมของคุณ
        const navigationData = {
            "TO_IT_BUILDING": { angle: 0, dist: 195, guide: "จากป้อมยามเดินตรงเข้ามาชั้นล่างตึกไอที (ตึกม่วง)" },
            "FROM_IT_TO_GATE": { angle: 180, dist: 195, guide: "จากหน้าตึกไอทีเดินย้อนกลับไปที่ป้อมยามหน้าประตู 1" },
            "DEPT_LABEL_3": { angle: 0, dist: 2, guide: "คุณอยู่บริเวณโถงหน้าป้ายแผนกชั้น 3" },
            "631": { angle: 90, dist: 15, guide: "จากโถงชั้น 3 เดินไปทางขวาสุด" },
            "632": { angle: 90, dist: 10, guide: "จากโถงชั้น 3 เดินไปทางขวา" },
            "633": { angle: 270, dist: 12, guide: "จากโถงชั้น 3 เดินไปทางซ้าย" },
            "634": { angle: 90, dist: 22, guide: "จากโถงชั้น 3 เดินไปทางขวาสุด (โซนศูนย์บ่มเพาะ)" },
            "635": { angle: 270, dist: 5, guide: "จากโถงชั้น 3 เลี้ยวซ้ายทันที (ติดบันได)" },
            "DEPT_LABEL_4": { angle: 0, dist: 2, guide: "คุณอยู่บริเวณหน้าโถงทางเข้าชั้น 4" },
            "TEACHER_ROOM": { angle: 90, dist: 5, guide: "จากโถงบันไดชั้น 4 เลี้ยวขวาเข้าห้องพักครู" },
            "LECTURE": { angle: 270, dist: 8, guide: "จากโถงบันไดชั้น 4 เลี้ยวซ้ายไปห้องบรรยาย" },
            "LAB1": { angle: 0, dist: 15, guide: "จากโถงชั้น 4 เดินตรงไปห้องแล็บ 1" },
            "LAB2": { angle: 0, dist: 18, guide: "จากโถงชั้น 4 เดินตรงไปห้องแล็บ 2" },
            "LAB3": { angle: 0, dist: 20, guide: "จากโถงชั้น 4 เดินตรงไปห้องแล็บ 3" }
        };

        const roomNames = {
            "TEACHER_ROOM": "ห้องพักครู", "LECTURE": "ห้อง Lecture", "LAB1": "ห้อง Lab 1", "LAB2": "ห้อง Lab 2", "LAB3": "ห้อง Lab 3",
            "631": "ห้องเรียน 631", "632": "ห้องเรียน 632", "633": "ห้องเรียน 633", "634": "ห้องเรียน 634", "635": "ห้องเรียน 635"
        };

        const roomImages = {
            'TEACHER_ROOM': 'breakteacher.jpeg', 'LECTURE': 'lecture.jpeg', 'LAB1': 'lab 1.jpeg',
            'LAB2': 'lab 2.jpeg', 'LAB3': 'lab 3.jpeg', '631': '631.jpeg', '632': '632.jpeg',
            '633': '633.jpeg', '634': '634.jpeg', '635': '635.jpeg'
        };

        function runLoading() {
            const loadingScreen = document.getElementById('loading-screen');
            const progressFill = document.getElementById('progress-fill');
            const isFirstVisit = !sessionStorage.getItem('stc_init');
            
            if (!isFirstVisit) { loadingScreen.style.display = 'none'; return; }
            
            let progress = 0;
            const timer = setInterval(() => {
                progress += Math.random() * 12;
                if (progress >= 100) {
                    progress = 100; clearInterval(timer);
                    setTimeout(() => {
                        loadingScreen.style.opacity = '0';
                        loadingScreen.style.pointerEvents = 'none';
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                            sessionStorage.setItem('stc_init', 'true');
                        }, 600);
                    }, 500);
                }
                progressFill.style.width = progress + '%';
            }, 80);
        }

        function renderRooms(floor) {
            const container = document.getElementById(`rooms-${floor}`);
            if (!container) return;
            container.innerHTML = '';
            
            Object.keys(navigationData).forEach(key => {
                if (key.includes("TO_") || key.includes("FROM_") || key.startsWith("DEPT_")) return;
                const isFloor3 = ['631','632','633','634','635'].includes(key);
                if ((floor === 3 && isFloor3) || (floor === 4 && !isFloor3)) {
                    container.innerHTML += `
                        <button onclick="openRoomDetail('${key}')" class="room-card p-6 text-left group">
                            <div class="text-[9px] font-bold text-gray-400 mb-2 uppercase tracking-tighter">Code: ${key}</div>
                            <h4 class="text-lg font-bold text-[#002D62] mb-4 group-hover:text-maroon transition-colors">${roomNames[key] || key}</h4>
                            <div class="text-maroon font-bold text-[10px] flex items-center gap-2">
                                <span class="border-b border-maroon">ดูข้อมูลสถานที่</span> <i class="fa-solid fa-chevron-right text-[8px]"></i>
                            </div>
                        </button>`;
                }
            });
        }

        function openRoomDetail(roomId) {
            const data = navigationData[roomId];
            document.getElementById('modal-room-id').innerText = roomId;
            document.getElementById('modal-room-name').innerText = roomNames[roomId] || roomId;
            document.getElementById('modal-room-guide').innerText = data.guide + ` (ระยะทางประมาณ ${data.dist} เมตร)`;
            document.getElementById('modal-room-image').src = roomImages[roomId] || '';
            document.getElementById('btn-start-nav').onclick = () => directNavigate(roomId);
            document.getElementById('room-detail-modal').classList.remove('hidden');
        }

        function closeRoomDetail() { document.getElementById('room-detail-modal').classList.add('hidden'); }

        function initApp() {
            const params = new URLSearchParams(window.location.search);
            const floor = params.get('floor');
            
            if (floor === '3' || floor === '4') {
                document.getElementById(`floor-${floor}`).classList.remove('hidden');
                document.getElementById('search-container').classList.remove('hidden');
                document.getElementById(`nav-f${floor}`).classList.add('nav-link-active');
                document.getElementById('floor-title').innerText = floor;
                renderRooms(parseInt(floor));
            } else {
                document.getElementById('start-phase').classList.remove('hidden');
                document.getElementById('nav-home').classList.add('nav-link-active');
            }
        }

        function directNavigate(roomId) {
            const data = navigationData[roomId];
            window.location.href = `ar-view.html?target=${roomId}&angle=${data.angle}&dist=${data.dist}&guide=${encodeURIComponent(data.guide)}`;
        }

        function searchRoom() {
            const input = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.room-card').forEach(card => {
                card.style.display = card.textContent.toLowerCase().includes(input) ? 'block' : 'none';
            });
        }

        window.onload = () => { runLoading(); initApp(); };
    </script>
</body>
</html>
