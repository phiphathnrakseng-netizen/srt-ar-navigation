<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>STC IT Navigation | ระบบนำทางแผนกไอที</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* Beige Theme Palette */
            --beige-dark: #D4C3A3;
            --beige-base: #F5F1E9;
            --beige-light: #FAF8F4;
            --navy-soft: #2C3E50;
            --accent-gold: #C5A059;
            --text-main: #4A4439;
        }

        body { 
            font-family: 'Noto Sans Thai', sans-serif; 
            background-color: var(--beige-base); 
            color: var(--text-main);
            margin: 0;
            -webkit-font-smoothing: antialiased;
        }

        .font-header { font-family: 'Montserrat', 'Noto Sans Thai', sans-serif; }

        /* --- UI Smooth Transitions --- */
        * { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border-radius: 20px; }

        /* --- Custom Loading --- */
        #loading-screen {
            position: fixed; inset: 0; background: var(--beige-light);
            z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .loader-ring {
            width: 80px; height: 80px;
            border: 4px solid var(--beige-dark);
            border-top: 4px solid var(--accent-gold);
            border-radius: 50% !important;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Cards & Buttons --- */
        .glass-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 10px 30px rgba(184, 163, 122, 0.1);
        }

        .btn-minimal {
            background: var(--navy-soft);
            color: white;
            padding: 1rem 2rem;
            border-radius: 16px !important;
            font-weight: 600;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }

        .btn-minimal:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }

        .room-card {
            background: white;
            border: 1px solid var(--beige-dark);
            padding: 2rem;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .room-card::after {
            content: ''; position: absolute; top: 0; left: 0; width: 6px; height: 100%;
            background: var(--accent-gold); border-radius: 0 !important;
        }

        .room-card:hover { border-color: var(--accent-gold); background: var(--beige-light); }

        /* --- Navigation --- */
        .nav-beige {
            background: rgba(245, 241, 233, 0.9);
            backdrop-filter: blur(15px);
            height: 80px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            border-radius: 0 !important;
        }

        .nav-link {
            padding: 0.5rem 1.2rem; border-radius: 12px !important;
            font-weight: 600; color: var(--text-main);
        }

        .nav-link-active { background: var(--accent-gold); color: white; }

        .header-section {
            background: linear-gradient(135deg, #E8E2D5 0%, #F5F1E9 100%);
            padding: 5rem 2rem; border-radius: 0 0 50px 50px !important;
            border-bottom: 2px solid var(--beige-dark);
        }
    </style>
</head>
<body>

    <div id="loading-screen">
        <img src="favicon.png" class="w-24 h-24 mb-6 animate-pulse" onerror="this.src='https://upload.wikimedia.org/wikipedia/th/a/a2/Surat_Thani_Technical_College_Logo.png'">
        <div class="loader-ring mb-4"></div>
        <div class="w-64 h-2 bg-gray-200 overflow-hidden">
            <div id="progress-fill" class="h-full bg-[#C5A059] w-0"></div>
        </div>
        <p id="speed-text" class="mt-4 font-bold text-xs tracking-widest text-[#C5A059] uppercase">Initializing System...</p>
    </div>

    <div id="dept-selector-modal" class="fixed inset-0 z-[200] flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/30 backdrop-blur-md" onclick="closeDeptModal()"></div>
        <div class="relative bg-white w-full max-w-md p-8 glass-card">
            <h3 class="text-2xl font-header font-extrabold text-[#2C3E50] mb-6">เลือกเส้นทางเดิน</h3>
            <div class="space-y-4">
                <button onclick="directNavigate('TO_IT_BUILDING')" class="w-full p-6 bg-beige-light border-2 border-[#D4C3A3] hover:border-[#C5A059] text-left">
                    <span class="text-[10px] font-bold text-accent-gold uppercase">Route A</span>
                    <div class="font-bold text-lg">ป้อมยาม → แผนกไอที</div>
                </button>
                <button onclick="directNavigate('FROM_IT_TO_GATE')" class="w-full p-6 bg-beige-light border-2 border-[#D4C3A3] hover:border-[#C5A059] text-left">
                    <span class="text-[10px] font-bold text-accent-gold uppercase">Route B</span>
                    <div class="font-bold text-lg">แผนกไอที → ป้อมยาม</div>
                </button>
            </div>
            <button onclick="closeDeptModal()" class="mt-6 w-full text-gray-400 font-bold">ยกเลิก</button>
        </div>
    </div>

    <div id="guide-modal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-stone-900/40 backdrop-blur-md"></div>
        <div class="relative bg-white max-w-md w-full p-10 glass-card text-center">
            <div class="w-20 h-20 bg-beige-base rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fa-solid fa-location-dot text-3xl text-accent-gold"></i>
            </div>
            <h3 class="text-2xl font-header font-bold mb-4">ยินดีต้อนรับสู่ระบบนำทาง</h3>
            <p id="guide-dynamic-text" class="text-gray-500 mb-8 leading-relaxed">
                กรุณายืนบริเวณ <span class="font-bold text-accent-gold">ป้อมยามหน้าวิทยาลัย</span> ก่อนเริ่มใช้งาน
            </p>
            <button onclick="closeModal()" class="w-full btn-minimal">เริ่มใช้งานเลย</button>
        </div>
    </div>

    <div id="room-detail-modal" class="fixed inset-0 z-[150] flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeRoomDetail()"></div>
        <div id="room-modal-content" class="relative bg-white w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh] glass-card">
            <div class="relative w-full h-64 bg-gray-100">
                <img id="modal-room-image" src="" class="w-full h-full object-cover" alt="Room" onerror="this.src='https://placehold.co/600x400/D4C3A3/FFF?text=STC+IT'">
                <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex items-end p-8">
                    <h3 id="modal-room-name" class="text-white text-3xl font-bold">ชื่อห้องเรียน</h3>
                </div>
            </div>
            <div class="p-8">
                <div class="flex items-center gap-4 mb-6">
                    <div class="bg-beige-base p-4 text-accent-gold"><i class="fa-solid fa-compass text-2xl"></i></div>
                    <div>
                        <h4 class="font-bold text-xs uppercase tracking-widest text-gray-400">คำแนะนำเส้นทาง</h4>
                        <p id="modal-room-guide" class="text-gray-600 font-medium italic">รายละเอียดทิศทาง...</p>
                    </div>
                </div>
                <button id="btn-start-nav" class="w-full btn-minimal py-5 text-lg">
                    <i class="fa-solid fa-paper-plane"></i> เริ่มนำทางแบบ AR
                </button>
            </div>
        </div>
    </div>

    <nav class="nav-beige sticky top-0 z-50 flex justify-between items-center px-8">
        <div class="flex items-center gap-3" onclick="window.location.href='index.html'">
            <img src="favicon.png" class="h-10 w-10 object-contain" onerror="this.src='https://upload.wikimedia.org/wikipedia/th/a/a2/Surat_Thani_Technical_College_Logo.png'">
            <div class="hidden sm:block">
                <div class="font-header font-black text-sm text-[#2C3E50] leading-none uppercase">STC IT NAVIGATION</div>
                <div class="text-[10px] font-bold text-accent-gold uppercase tracking-[0.2em]">Minimal Beige Edition</div>
            </div>
        </div>
        <div class="flex gap-2">
            <a href="index.html" class="nav-link" id="nav-home">หน้าหลัก</a>
            <a href="?floor=3" class="nav-link" id="nav-f3">ชั้น 3</a>
            <a href="?floor=4" class="nav-link" id="nav-f4">ชั้น 4</a>
        </div>
    </nav>

    <header class="header-section text-center">
        <div class="max-w-4xl mx-auto">
            <div class="inline-block px-4 py-1 bg-white rounded-full border border-beige-dark text-[10px] font-bold uppercase tracking-widest mb-6">Digital Campus Guide</div>
            <h1 class="text-4xl md:text-6xl font-header font-black text-[#2C3E50] mb-6 leading-tight">
                สำรวจแผนกไอที <br> <span class="text-accent-gold">ด้วยเทคโนโลยี AR</span>
            </h1>
            <p id="header-desc" class="text-gray-500 max-w-xl mx-auto font-medium">
                เริ่มต้นการเดินทางจากป้อมยามหน้าวิทยาลัย หรือเลือกดูห้องเรียนชั้น 3 และ 4
            </p>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-6 py-12">
        <div id="search-container" class="mb-12 hidden">
            <div class="relative max-w-2xl mx-auto">
                <input type="text" id="searchInput" onkeyup="searchRoom()" placeholder="ค้นหาชื่อห้อง หรือเลขห้อง..." class="w-full bg-white border-2 border-beige-dark p-6 outline-none focus:border-accent-gold font-bold text-lg shadow-sm">
                <i class="fa-solid fa-search absolute right-6 top-1/2 -translate-y-1/2 text-gray-300"></i>
            </div>
        </div>

        <div id="start-phase" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                <button onclick="directNavigate('TO_IT_BUILDING')" class="room-card group">
                    <h3 class="text-2xl font-bold mb-2">ป้อมยาม <i class="fa-solid fa-arrow-right-long mx-2 text-accent-gold"></i> แผนกไอที</h3>
                    <p class="text-gray-400 font-medium">เริ่มต้นที่ประตู 1 (Outdoor)</p>
                </button>
                <button onclick="directNavigate('FROM_IT_TO_GATE')" class="room-card group">
                    <h3 class="text-2xl font-bold mb-2">แผนกไอที <i class="fa-solid fa-arrow-right-long mx-2 text-accent-gold"></i> ป้อมยาม</h3>
                    <p class="text-gray-400 font-medium">เดินทางออกจากวิทยาลัย</p>
                </button>
            </div>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="?floor=3" class="btn-minimal bg-white !text-gray-700 border border-beige-dark shadow-sm">สำรวจห้องเรียนชั้น 3</a>
                <a href="?floor=4" class="btn-minimal bg-white !text-gray-700 border border-beige-dark shadow-sm">สำรวจห้องเรียนชั้น 4</a>
            </div>
        </div>

        <div id="floor-3" class="hidden"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="rooms-3"></div></div>
        <div id="floor-4" class="hidden"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="rooms-4"></div></div>
    </main>

    <footer class="py-12 text-center text-gray-400 font-medium border-t border-beige-dark bg-white/50">
        <p class="text-[10px] uppercase tracking-[0.3em] mb-2">Created By</p>
        <p class="text-gray-600">Information Technology Department, STC</p>
    </footer>

    <script>
        // --- Same Logic as Original (Nothing missing) ---
        function runLoading() {
            const loadingScreen = document.getElementById('loading-screen');
            const progressFill = document.getElementById('progress-fill');
            const speedText = document.getElementById('speed-text');
            const isFirstVisit = !sessionStorage.getItem('stc_init_complete');
            if (!isFirstVisit) { loadingScreen.style.display = 'none'; return; }
            
            let progress = 0;
            const timer = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100; clearInterval(timer);
                    setTimeout(() => {
                        loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                            sessionStorage.setItem('stc_init_complete', 'true');
                            showGuideModal();
                        }, 600);
                    }, 800);
                } else {
                    progressFill.style.width = progress + '%';
                    speedText.innerText = `Loading Assets... ${Math.round(progress)}%`;
                }
            }, 100);
        }

        const navigationData = {
            "TO_IT_BUILDING": { angle: 0, dist: 195, guide: "จากป้อมยามเดินตรงเข้ามาชั้นล่างตึกไอที (ตึกม่วง)" },
            "FROM_IT_TO_GATE": { angle: 180, dist: 195, guide: "จากหน้าตึกไอทีเดินย้อนกลับไปที่ป้อมยามหน้าประตู 1" },
            "DEPT_LABEL_3": { angle: 0, dist: 2, guide: "คุณอยู่บริเวณโถงหน้าป้ายแผนกชั้น 3" },
            "631": { angle: 90, dist: 15, guide: "จากโถงชั้น 3 เดินไปทางขวาสุด" },
            "632": { angle: 90, dist: 10, guide: "จากโถงชั้น 3 เดินไปทางขวา" },
            "633": { angle: 270, dist: 12, guide: "จากโถงชั้น 3 เดินไปทางซ้าย" },
            "634": { angle: 90, dist: 22, guide: "จากโถงชั้น 3 เดินไปทางขวาสุด (โซนศูนย์บ่มเพาะ)" },
            "635": { angle: 270, dist: 5, guide: "จากโถงชั้น 3 เลี้ยวซ้ายทันที (ติดบันได)" },
            "DEPT_LABEL_4": { angle: 0, dist: 2, guide: "คุณอยู่บริเวณหน้าโถงทางเข้าชั้น 4" },
            "TEACHER_ROOM": { angle: 90, dist: 5, guide: "จากโถงบันไดชั้น 4 เลี้ยวขวาเข้าห้องพักครู" },
            "LECTURE": { angle: 270, dist: 8, guide: "จากโถงบันไดชั้น 4 เลี้ยวซ้ายไปห้องบรรยาย" },
            "LAB1": { angle: 0, dist: 15, guide: "จากโถงชั้น 4 เดินตรงไปห้องแล็บ 1" },
            "LAB2": { angle: 0, dist: 18, guide: "จากโถงชั้น 4 เดินตรงไปห้องแล็บ 2" },
            "LAB3": { angle: 0, dist: 20, guide: "จากโถงชั้น 4 เดินตรงไปห้องแล็บ 3" }
        };

        function getRoomName(id) {
            const names = {
                "631": "ห้อง 631", "632": "ห้อง 632", "633": "ห้อง 633", "634": "ห้อง 634", "635": "ห้อง 635",
                "TEACHER_ROOM": "ห้องพักครู", "LECTURE": "ห้อง Lecture", "LAB1": "ห้อง Lab 1", "LAB2": "ห้อง Lab 2", "LAB3": "ห้อง Lab 3"
            };
            return names[id] || id;
        }

        function showGuideModal() {
            const floor = new URLSearchParams(window.location.search).get('floor');
            if (floor) document.getElementById('guide-dynamic-text').innerText = `สำหรับการนำทางชั้น ${floor} กรุณายืนบริเวณโถงหน้าบันได/ป้ายแผนกชั้น ${floor}`;
            document.getElementById('guide-modal').classList.remove('hidden');
        }

        function openRoomDetail(roomId) {
            const data = navigationData[roomId];
            document.getElementById('modal-room-name').innerText = getRoomName(roomId);
            document.getElementById('modal-room-guide').innerText = data.guide + ` (ระยะ ${data.dist} ม.)`;
            
            const roomImages = {
                'TEACHER_ROOM': 'breakteacher.jpeg', 'LECTURE': 'lecture.jpeg', 'LAB1': 'lab 1.jpeg',
                'LAB2': 'lab 2.jpeg', 'LAB3': 'lab 3.jpeg', '631': '631.jpeg', '632': '632.jpeg',
                '633': '633.jpeg', '634': '634.jpeg', '635': '635.jpeg'
            };
            document.getElementById('modal-room-image').src = roomImages[roomId] || '';
            document.getElementById('btn-start-nav').onclick = () => directNavigate(roomId);
            document.getElementById('room-detail-modal').classList.remove('hidden');
        }

        function renderRooms(floor) {
            const container = document.getElementById(`rooms-${floor}`);
            container.innerHTML = '';
            
            // Start Point Card
            const startId = (floor === 3) ? "DEPT_LABEL_3" : "DEPT_LABEL_4";
            container.innerHTML += `<button onclick="directNavigate('${startId}')" class="room-card border-accent-gold bg-beige-light">
                <span class="text-xs font-bold text-accent-gold uppercase">Current Floor Base</span>
                <h3 class="text-2xl font-bold">โถงหน้าบันได ชั้น ${floor}</h3>
                <p class="text-gray-400 mt-2">ยืนจุดนี้เพื่อเริ่มนำทาง</p></button>`;

            Object.keys(navigationData).forEach(key => {
                if (key.includes("TO_") || key.includes("FROM_") || key.startsWith("DEPT_")) return;
                const isFloor3 = ['631','632','633','634','635'].includes(key);
                if ((floor === 3 && isFloor3) || (floor === 4 && !isFloor3)) {
                    container.innerHTML += `<button onclick="openRoomDetail('${key}')" class="room-card">
                        <span class="text-xs font-bold text-gray-400 uppercase">Room ID: ${key}</span>
                        <h3 class="text-2xl font-bold">${getRoomName(key)}</h3>
                        <div class="mt-4 text-accent-gold font-bold">ดูรายละเอียด <i class="fa-solid fa-chevron-right ml-1"></i></div></button>`;
                }
            });
        }

        function initApp() {
            const floor = new URLSearchParams(window.location.search).get('floor');
            if (floor === '3' || floor === '4') {
                document.getElementById(`floor-${floor}`).classList.remove('hidden');
                document.getElementById('search-container').classList.remove('hidden');
                document.getElementById(`nav-f${floor}`).classList.add('nav-link-active');
                renderRooms(parseInt(floor));
            } else {
                document.getElementById('start-phase').classList.remove('hidden');
                document.getElementById('nav-home').classList.add('nav-link-active');
            }
        }

        function directNavigate(roomId) {
            const data = navigationData[roomId];
            window.location.href = `ar-view.html?target=${roomId}&angle=${data.angle}&dist=${data.dist}&guide=${encodeURIComponent(data.guide)}`;
        }

        function searchRoom() {
            const input = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.room-card').forEach(card => {
                card.style.display = card.textContent.toLowerCase().includes(input) ? 'block' : 'none';
            });
        }

        function closeModal() { document.getElementById('guide-modal').classList.add('hidden'); }
        function closeRoomDetail() { document.getElementById('room-detail-modal').classList.add('hidden'); }
        function closeDeptModal() { document.getElementById('dept-selector-modal').classList.add('hidden'); }
        window.addEventListener('DOMContentLoaded', () => { runLoading(); initApp(); });
    </script>
</body>
</html>
