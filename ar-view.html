<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR Navigation - Zero Overlap</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@600;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Sarabun', sans-serif; background: #000; }

        /* ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß: ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏î‡∏≥‡∏ó‡∏∂‡∏ö 100% ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô */
        #ui-header {
            position: fixed; top: 0; left: 0; width: 100%;
            background: #000; padding: 15px 0;
            text-align: center; z-index: 2000;
            border-bottom: 3px solid #3b82f6;
            display: none;
        }

        /* ‡∏™‡πà‡∏ß‡∏ô‡∏•‡πà‡∏≤‡∏á: ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏î‡∏≥‡∏ó‡∏∂‡∏ö */
        #ui-footer {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: #000; z-index: 2000;
            display: none; flex-direction: column;
            border-top: 3px solid #3b82f6;
        }

        #guidance-panel {
            padding: 20px; text-align: center; color: #fff;
        }

        #sensor-warning {
            background: #ffcc00; color: #000; padding: 10px;
            text-align: center; font-weight: 700; font-size: 0.9rem;
        }

        .label { font-size: 0.75rem; color: #3b82f6; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 5px; }
        .target { font-size: 1.4rem; font-weight: 700; color: #fff; }
        .step-text { font-size: 1.6rem; font-weight: 700; }

        #entry-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999; display: flex; flex-direction: column;
            justify-content: center; align-items: center; color: white;
        }
        .start-btn {
            background: #3b82f6; color: white; padding: 25px 50px;
            border-radius: 10px; font-size: 1.4rem; font-weight: 700; border: none;
        }
    </style>
</head>
<body>

    <div id="entry-screen">
        <button class="start-btn" onclick="initPrecisionAR()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏≥‡∏ó‡∏≤‡∏á (START)</button>
        <p style="margin-top:20px; opacity:0.8;">‡∏ñ‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏£‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</p>
    </div>

    <div id="ui-header">
        <div class="label">‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢</div>
        <div id="room-id" class="target">...</div>
    </div>

    <div id="ui-footer">
        <div id="guidance-panel">
            <div class="label" style="color: #aaa;">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>
            <span class="step-text">üö∂ ‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å 10 ‡πÄ‡∏°‡∏ï‡∏£</span>
        </div>
        <div id="sensor-warning">
            ‚ö†Ô∏è ‡∏´‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏®‡∏£‡∏´‡∏°‡∏∏‡∏ô‡∏£‡∏ß‡∏ô ‡πÉ‡∏´‡πâ‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏≤‡∏° "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°" ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å
        </div>
    </div>

    <a-scene embedded vr-mode-ui="enabled: false" arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-entity camera id="fixed-camera"></a-entity>
        
        <a-entity id="arrow-pivot" position="0 -1.5 -4" visible="false">
            <a-entity id="arrow-visual">
                <a-cone radius-bottom="0.3" height="0.6" material="color: #3b82f6; emissive: #3b82f6; emissiveIntensity: 0.5;" rotation="90 0 0"></a-cone>
                <a-box position="0 -0.4 0" width="0.15" height="0.5" depth="0.1" material="color: #1e3a8a;"></a-box>
            </a-entity>
        </a-entity>
    </a-scene>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        document.getElementById('room-id').innerText = urlParams.get('target') || '‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì';

        let initialAlpha = null;
        let targetRotY = 0;
        let lerpedRotY = 0;
        const smoothSpeed = 0.15;

        async function initPrecisionAR() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                const res = await DeviceOrientationEvent.requestPermission();
                if (res === 'granted') window.addEventListener('deviceorientation', onDeviceMove);
            } else {
                window.addEventListener('deviceorientation', onDeviceMove);
            }
            showUI();
        }

        function onDeviceMove(event) {
            if (event.alpha === null) return;
            if (initialAlpha === null) initialAlpha = event.alpha;
            targetRotY = event.alpha - initialAlpha; 
        }

        function showUI() {
            document.getElementById('entry-screen').style.display = 'none';
            document.getElementById('ui-header').style.display = 'block';
            document.getElementById('ui-footer').style.display = 'flex';
            document.getElementById('arrow-pivot').setAttribute('visible', 'true');
        }

        function animate() {
            let diff = targetRotY - lerpedRotY;
            while (diff < -180) diff += 360;
            while (diff > 180) diff -= 360;
            lerpedRotY += diff * smoothSpeed;

            const pivot = document.getElementById('arrow-pivot');
            if (pivot && pivot.getAttribute('visible')) {
                // ‡∏´‡∏°‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
                pivot.object3D.rotation.y = THREE.MathUtils.degToRad(-lerpedRotY);
            }
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>
